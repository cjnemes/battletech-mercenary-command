<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes, viewport-fit=cover">
    <title>Battletech Mercenary Command</title>
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Battletech Command">
    <meta name="theme-color" content="#0c0f1a">
    <meta name="msapplication-navbutton-color" content="#0c0f1a">
    <meta name="msapplication-TileColor" content="#0c0f1a">
    
    <!-- SEO and Social Meta Tags -->
    <meta name="description" content="Professional Battletech Mercenary Command game with immersive audio and mobile-optimized gameplay">
    <meta name="keywords" content="battletech, mercenary, mech, strategy, tactical, sci-fi">
    <meta name="author" content="Battletech Command Team">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Battletech Mercenary Command">
    <meta property="og:description" content="Lead your mercenary company in the Battletech universe">
    <meta property="og:type" content="website">
    <meta property="og:image" content="/web/src/assets/images/og-image.png">
    
    <!-- Touch Icons and Favicons -->
    <link rel="icon" type="image/x-icon" href="/web/src/assets/images/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/web/src/assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/web/src/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/web/src/assets/images/favicon-16x16.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/web/manifest.json">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- DNS Prefetch for Performance -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="/web/src/assets/audio/ui/button-click.wav" as="audio">
    <link rel="preload" href="/web/src/systems/js/GameEngine.js" as="script">
    <link rel="preload" href="/web/src/systems/js/AudioManager.js" as="script">
    <link rel="preload" href="/web/src/systems/js/MobileOptimizer.js" as="script">
</head>
<body>
    <div id="app">
        <!-- Main Menu Screen -->
        <div id="main-menu" class="screen active">
            <div class="container">
                <div class="title">
                    <h1>BATTLETECH</h1>
                    <h2>MERCENARY COMMAND</h2>
                </div>
                
                <div class="menu-buttons">
                    <button id="new-company-btn" class="btn btn-primary" onclick="startNewGame()">New Company</button>
                    <button id="load-game-btn" class="btn btn-secondary" onclick="loadGame()">Load Game</button>
                    <button class="btn btn-secondary" onclick="showSettings()">Settings</button>
                    <button class="btn btn-danger" onclick="quitGame()">Quit</button>
                </div>
                
                <div class="version">Alpha v0.1.0</div>
            </div>
        </div>

        <!-- Company Overview Screen -->
        <div id="company-overview" class="screen">
            <div class="header">
                <h2>Company Overview</h2>
                <div class="nav-buttons">
                    <button id="mech-bay-btn" class="btn btn-sm" onclick="showMechBay()">Mech Bay</button>
                    <button id="star-map-btn" class="btn btn-sm" onclick="showStarMap()">Star Map</button>
                    <button class="btn btn-sm" onclick="showMainMenu()">Back</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="left-panel">
                    <div class="info-card company-stats">
                        <h3>Company Status</h3>
                        <div class="stat-line">
                            <span>Company:</span>
                            <span id="company-name">Wolf's Dragoons</span>
                        </div>
                        <div class="stat-line">
                            <span>Funds:</span>
                            <span id="company-funds" class="funds funds-display">500,000 C-Bills</span>
                        </div>
                        <div class="stat-line">
                            <span>Rating:</span>
                            <span id="company-rating">Green</span>
                        </div>
                        <div class="stat-line">
                            <span>Date:</span>
                            <span id="current-date">January 1, 3025</span>
                        </div>
                        <hr>
                        <div class="stat-line">
                            <span>Monthly Expenses:</span>
                            <span id="monthly-expenses" class="expenses">45,000 C-Bills</span>
                        </div>
                        <div class="stat-line">
                            <span>Monthly Income:</span>
                            <span id="monthly-income" class="income">0 C-Bills</span>
                        </div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="info-card">
                        <div class="card-header">
                            <h3>Personnel Roster</h3>
                            <button class="btn btn-sm btn-primary" onclick="hirePilot()">Hire Pilot</button>
                        </div>
                        <div id="pilot-list" class="pilot-list">
                            <!-- Pilots will be populated here -->
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div id="pilot-details" class="pilot-details">
                            <h3>Select a Pilot</h3>
                            <p>Choose a pilot from the roster to view detailed information.</p>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>Faction Reputation</h3>
                        <div id="reputation-list" class="reputation-list reputation-display">
                            <!-- Reputation will be populated here -->
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>Inner Sphere Intel - 3025</h3>
                        <div id="political-intel" class="political-intel">
                            <div class="political-events">
                                <div class="event-title">Fourth Succession War Tensions</div>
                                <div class="event-description">The Great Houses prepare for renewed conflict as political alliances shift across the Inner Sphere.</div>
                                <div class="event-impact">Impact: Increased mercenary demand, higher contract rates</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mech Bay Screen -->
        <div id="mech-bay" class="screen">
            <div class="header">
                <h2>Mech Bay</h2>
                <div class="nav-buttons">
                    <button class="btn btn-sm" onclick="showCompanyOverview()">Back</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="left-panel">
                    <div class="info-card">
                        <h3>Mech Roster</h3>
                        <div id="mech-list" class="mech-list">
                            <!-- Mechs will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="info-card">
                        <div id="mech-details" class="mech-details">
                            <h3>Select a Mech</h3>
                            <p>Choose a mech from the roster to view details and manage pilot assignments.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Star Map Screen -->
        <div id="star-map" class="screen">
            <div class="header">
                <h2>Star Map - Available Contracts</h2>
                <div class="nav-buttons">
                    <button class="btn btn-sm" onclick="refreshContracts()">Refresh</button>
                    <button class="btn btn-sm" onclick="advanceTime()">Advance Time (7 days)</button>
                    <button class="btn btn-sm" onclick="showCompanyOverview()">Back</button>
                </div>
            </div>
            
            <div class="main-content">
                <div class="left-panel">
                    <div class="info-card">
                        <h3>Available Contracts</h3>
                        <div id="contract-list" class="contract-list">
                            <!-- Contracts will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="info-card">
                        <div id="contract-details" class="contract-details">
                            <h3>Select a Contract</h3>
                            <p>Choose a contract from the list to view mission details and requirements.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tactical Combat Screen -->
        <div id="tactical-combat" class="screen">
            <div class="header">
                <h2>Tactical Combat</h2>
                <div class="nav-buttons">
                    <button class="btn btn-sm" id="end-turn-btn" onclick="endTurn()">End Turn</button>
                    <button class="btn btn-sm btn-danger" onclick="exitCombat()">Exit Combat</button>
                </div>
            </div>
            
            <div class="combat-container">
                <div class="battlefield-panel">
                    <canvas id="battlefield" width="800" height="600"></canvas>
                </div>
                
                <div class="combat-ui">
                    <div class="info-card">
                        <h3>Turn Info</h3>
                        <div class="stat-line">
                            <span>Turn:</span>
                            <span id="turn-number">1</span>
                        </div>
                        <div class="stat-line">
                            <span>Current Unit:</span>
                            <span id="current-unit">Select Unit</span>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3 id="unit-info-title">Unit Info</h3>
                        <div id="unit-details">
                            <p>Select a unit to view details</p>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h3>Combat Log</h3>
                        <div id="combat-log" class="combat-log">
                            <div class="log-entry">Combat initialized...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/web/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available, prompt user
                                    if (confirm('New version available! Reload to update?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('SW registration failed: ', error);
                    });
                    
                // Listen for messages from service worker
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'CACHE_CLEARED') {
                        console.log('Service worker cache cleared');
                    }
                });
            });
        }
        
        // Install prompt handling
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show custom install button or banner
            const installBanner = document.createElement('div');
            installBanner.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; right: 20px; background: var(--card-bg); 
                           border: 2px solid var(--border-highlight); border-radius: 8px; padding: 15px; 
                           z-index: 10000; text-align: center;">
                    <p style="margin-bottom: 10px; color: var(--primary-text);">Install Battletech Command for a better experience!</p>
                    <button onclick="installApp()" style="margin-right: 10px;" class="btn btn-primary">Install</button>
                    <button onclick="dismissInstall()" class="btn btn-secondary">Not Now</button>
                </div>
            `;
            document.body.appendChild(installBanner);
            
            window.installApp = () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    installBanner.remove();
                });
            };
            
            window.dismissInstall = () => {
                installBanner.remove();
                deferredPrompt = null;
            };
        });
        
        // Handle app installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('App was installed successfully');
        });
        
        // Prevent iOS bounce scrolling
        document.addEventListener('touchmove', (e) => {
            if (e.target.closest('.scrollable, input, textarea, select') === null) {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Handle mobile viewport height changes
        const setVH = () => {
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        
        setVH();
        window.addEventListener('resize', setVH);
        window.addEventListener('orientationchange', () => {
            setTimeout(setVH, 500);
        });
    </script>

    <script src="game_bulletproof_v2.js"></script>
</body>
</html>