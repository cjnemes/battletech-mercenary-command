<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Bulletproof Architecture Test - Phases 1, 2 & 3</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0c0f1a;
            color: #e0e0e0;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: #1a1f2e;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #2a3441;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .success {
            background: #1e4a2e;
            border: 1px solid #4caf50;
            color: #4caf50;
        }
        
        .error {
            background: #4a1e1e;
            border: 1px solid #f44336;
            color: #f44336;
        }
        
        .info {
            background: #1e2a4a;
            border: 1px solid #2196f3;
            color: #2196f3;
        }
        
        .phase-complete {
            background: #1e4a3e;
            border: 2px solid #00ff41;
            color: #00ff41;
            font-weight: bold;
            text-align: center;
            padding: 15px;
            margin: 15px 0;
        }
        
        button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #357abd;
        }
        
        button.success {
            background: #4caf50;
        }
        
        .log-output {
            background: #0a0a0a;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .demo-section {
            background: #1e2a1e;
            border: 1px solid #4a6a4a;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        .screen {
            position: relative;
            background: #252b3a;
            border: 1px solid #3a4552;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        
        .screen.hidden {
            opacity: 0;
            visibility: hidden;
        }
        
        .screen.active {
            border-color: #4a90e2;
        }
        
        .pilot-card, .mech-card, .contract-card {
            background: #2a3441;
            border: 1px solid #3a4552;
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .pilot-card:hover, .mech-card:hover, .contract-card:hover {
            border-color: #4a90e2;
        }
        
        .pilot-card.selected, .mech-card.selected, .contract-card.selected {
            background: #1e2a4a;
            border-color: #4a90e2;
        }
        
        .pilot-header, .mech-header, .contract-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .experience.Elite { color: #ff9800; }
        .experience.Veteran { color: #4caf50; }
        .experience.Regular { color: #2196f3; }
        .experience.Green { color: #9e9e9e; }
        
        .stat-line, .detail-line {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }
        
        .stat-value { font-weight: bold; color: #4caf50; }
        .salary, .payment { color: #ff9800; }
        .status.Available { color: #4caf50; }
        .condition.Excellent { color: #4caf50; }
        .condition.Good { color: #8bc34a; }
        .condition.Fair { color: #ff9800; }
        
        h1 {
            text-align: center;
            color: #4a90e2;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #6ab7ff;
            border-bottom: 1px solid #3a4552;
            padding-bottom: 10px;
        }
        
        h3 {
            color: #8cc8ff;
        }
        
        pre {
            margin: 0;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üõ°Ô∏è COMPLETE BULLETPROOF ARCHITECTURE TEST</h1>
        <p style="text-align: center; color: #8cc8ff;">Phase 1 (Core) + Phase 2 (State) + Phase 3 (UI) Integration</p>
        
        <!-- Control Panel -->
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="runCompleteTest()" class="success">üöÄ Run Complete Architecture Test</button>
            <button onclick="runUIDemo()">üéÆ Live UI Demo</button>
            <button onclick="clearResults()">Clear Results</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <!-- Test Results -->
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin: 20px 0;">
            <div>
                <h2>üîß Phase 1: Core Systems</h2>
                <div id="phase1-results"></div>
            </div>
            <div>
                <h2>üóÑÔ∏è Phase 2: State Management</h2>
                <div id="phase2-results"></div>
            </div>
            <div>
                <h2>üé® Phase 3: UI Foundation</h2>
                <div id="phase3-results"></div>
            </div>
        </div>
        
        <!-- Full Integration Results -->
        <div>
            <h2>üöÄ Complete Integration Test</h2>
            <div id="integration-results"></div>
        </div>
        
        <!-- Live UI Demo -->
        <div class="demo-section">
            <h2>üéÆ Live UI System Demonstration</h2>
            <div id="ui-demo">
                <p>Run the UI demo to see screen management and components working...</p>
            </div>
            
            <!-- Demo Screens -->
            <div id="demo-screen-1" class="screen active">
                <h3>Demo Screen 1: Company Overview</h3>
                <button onclick="showScreen('demo-screen-2')">Go to Pilot Roster</button>
                <div id="pilot-list"></div>
            </div>
            
            <div id="demo-screen-2" class="screen hidden">
                <h3>Demo Screen 2: Pilot Roster</h3>
                <button onclick="showScreen('demo-screen-1')">Back to Overview</button>
                <button onclick="showScreen('demo-screen-3')">Go to Mech Bay</button>
                <div id="pilot-cards"></div>
            </div>
            
            <div id="demo-screen-3" class="screen hidden">
                <h3>Demo Screen 3: Mech Bay</h3>
                <button onclick="showScreen('demo-screen-2')">Back to Pilots</button>
                <div id="mech-cards"></div>
            </div>
        </div>
        
        <!-- System Log -->
        <div>
            <h2>üìù System Log</h2>
            <div id="log-output" class="log-output">
                <pre id="log-content">Initializing complete bulletproof architecture test...</pre>
            </div>
        </div>
    </div>

    <script>
        // Inline implementation of all classes for testing
        
        // Logger class
        class Logger {
            constructor(context = 'Game') {
                this.context = context;
                this.logs = [];
                this.maxLogs = 100;
                this.startTime = Date.now();
                this.fallbackMode = false;
                console.log(`[${this.context}] Logger initialized`);
            }
            
            log(level, message, data = null) {
                const timestamp = new Date().toISOString();
                const logEntry = { timestamp, level, context: this.context, message, data };
                this.logs.push(logEntry);
                
                if (this.logs.length > this.maxLogs) {
                    this.logs = this.logs.slice(-this.maxLogs * 0.8);
                }
                
                const consoleMessage = `[${level}] [${this.context}] ${message}`;
                console.log(consoleMessage, data);
            }
            
            error(message, data) { this.log('ERROR', message, data); }
            warn(message, data) { this.log('WARN', message, data); }
            info(message, data) { this.log('INFO', message, data); }
            debug(message, data) { this.log('DEBUG', message, data); }
            
            getStatus() {
                return {
                    context: this.context,
                    fallbackMode: this.fallbackMode,
                    totalLogs: this.logs.length,
                    uptime: Date.now() - this.startTime
                };
            }
        }
        
        // EventBus class
        class EventBus {
            constructor(logger) {
                this.logger = logger || console;
                this.listeners = new Map();
                this.eventHistory = [];
                this.maxHistory = 100;
                this.logger.info?.('EventBus initialized') || console.log('EventBus initialized');
            }
            
            on(eventName, callback) {
                if (!this.listeners.has(eventName)) {
                    this.listeners.set(eventName, []);
                }
                this.listeners.get(eventName).push(callback);
                this.logger.debug?.(`Subscribed to: ${eventName}`) || console.debug(`Subscribed to: ${eventName}`);
            }
            
            emit(eventName, data = null) {
                this.recordEvent(eventName, data);
                
                if (!this.listeners.has(eventName)) {
                    this.logger.debug?.(`No listeners for: ${eventName}`) || console.debug(`No listeners for: ${eventName}`);
                    return;
                }
                
                const listeners = this.listeners.get(eventName);
                listeners.forEach((callback, index) => {
                    try {
                        callback(data);
                    } catch (error) {
                        this.logger.error?.(`Listener error for ${eventName}[${index}]`, error) || 
                            console.error(`Listener error for ${eventName}:`, error);
                    }
                });
            }
            
            recordEvent(eventName, data) {
                this.eventHistory.push({
                    timestamp: Date.now(),
                    name: eventName,
                    data: data,
                    listenerCount: this.listeners.has(eventName) ? this.listeners.get(eventName).length : 0
                });
                
                if (this.eventHistory.length > this.maxHistory) {
                    this.eventHistory = this.eventHistory.slice(-this.maxHistory * 0.8);
                }
            }
            
            getStatus() {
                return {
                    totalEventTypes: this.listeners.size,
                    totalListeners: Array.from(this.listeners.values()).reduce((sum, arr) => sum + arr.length, 0),
                    eventHistory: this.eventHistory.length,
                    eventTypes: Array.from(this.listeners.keys())
                };
            }
        }
        
        // Game class
        class Game {
            constructor() {
                this.initialized = false;
                this.modules = new Map();
                
                try {
                    this.logger = new Logger('Game');
                    this.eventBus = new EventBus(this.logger);
                    this.initialized = true;
                    this.logger.info('Game core initialization complete');
                    this.eventBus.emit('game.initialized', { timestamp: Date.now() });
                } catch (error) {
                    console.error('Game initialization failed:', error);
                    throw error;
                }
            }
            
            registerModule(name, moduleInstance) {
                this.modules.set(name, moduleInstance);
                this.logger.info(`Module registered: ${name}`);
                this.eventBus.emit('module.registered', { name, timestamp: Date.now() });
            }
            
            getModule(name) {
                return this.modules.get(name) || null;
            }
            
            getStatus() {
                return {
                    initialized: this.initialized,
                    modules: Array.from(this.modules.keys()),
                    eventBusStatus: this.eventBus.getStatus(),
                    loggerStatus: this.logger.getStatus()
                };
            }
        }
        
        // GameState class (simplified)
        class GameState {
            constructor(eventBus, logger) {
                this.eventBus = eventBus;
                this.logger = logger;
                this.initialized = false;
                
                this.state = {
                    company: { name: 'Wolf\\'s Dragoons', funds: 500000 },
                    personnel: {
                        pilots: new Map([
                            [1, { id: 1, name: 'Marcus Kane', gunnery: 2, piloting: 3, experience: 'Elite', salary: 25000, status: 'Available' }],
                            [2, { id: 2, name: 'Lisa Williams', gunnery: 3, piloting: 4, experience: 'Veteran', salary: 18000, status: 'Available' }],
                            [3, { id: 3, name: 'Chen Liu', gunnery: 4, piloting: 3, experience: 'Regular', salary: 12000, status: 'Available' }]
                        ])
                    },
                    assets: {
                        mechs: new Map([
                            [1, { id: 1, name: 'Centurion CN9-A', weight: 50, type: 'Medium', condition: 'Excellent', pilot: 1, armor: 100, weapons: ['AC/10', 'LRM-10'] }],
                            [2, { id: 2, name: 'Phoenix Hawk PXH-1', weight: 45, type: 'Medium', condition: 'Good', pilot: 2, armor: 85, weapons: ['Large Laser', 'Machine Gun'] }],
                            [3, { id: 3, name: 'Locust LCT-1V', weight: 20, type: 'Light', condition: 'Fair', pilot: null, armor: 60, weapons: ['Medium Laser'] }]
                        ])
                    }
                };
                
                this.initialized = true;
                this.logger.info('GameState initialized');
                this.eventBus.emit('gamestate.initialized', { timestamp: Date.now() });
            }
            
            getState() {
                return JSON.parse(JSON.stringify(this.state, (key, value) => {
                    if (value instanceof Map) {
                        return { __type: 'Map', __data: Array.from(value.entries()) };
                    }
                    return value;
                }));
            }
            
            getPilots() {
                return Array.from(this.state.personnel.pilots.values());
            }
            
            getMechs() {
                return Array.from(this.state.assets.mechs.values());
            }
        }
        
        // ScreenManager class (simplified)
        class ScreenManager {
            constructor(eventBus, logger) {
                this.eventBus = eventBus;
                this.logger = logger;
                this.initialized = false;
                this.screens = new Map();
                this.currentScreen = null;
                
                this.discoverScreens();
                this.initialized = true;
                this.logger.info('ScreenManager initialized');
                this.eventBus.emit('screenmanager.initialized', { timestamp: Date.now() });
            }
            
            discoverScreens() {
                const screenElements = document.querySelectorAll('.screen, [data-screen]');
                screenElements.forEach(element => {
                    const screenId = element.id || element.getAttribute('data-screen');
                    if (screenId) {
                        this.screens.set(screenId, {
                            id: screenId,
                            element: element,
                            visible: !element.classList.contains('hidden')
                        });
                    }
                });
                this.logger.info(`Discovered ${this.screens.size} screens`);
            }
            
            showScreen(screenId) {
                if (!this.screens.has(screenId)) {
                    this.logger.warn(`Unknown screen: ${screenId}`);
                    return false;
                }
                
                // Hide all screens
                this.screens.forEach(screen => {
                    screen.element.classList.add('hidden');
                    screen.element.classList.remove('active');
                    screen.visible = false;
                });
                
                // Show target screen
                const targetScreen = this.screens.get(screenId);
                targetScreen.element.classList.remove('hidden');
                targetScreen.element.classList.add('active');
                targetScreen.visible = true;
                
                this.currentScreen = screenId;
                this.logger.info(`Showing screen: ${screenId}`);
                this.eventBus.emit('screen.shown', { screenId, timestamp: Date.now() });
                
                return true;
            }
            
            getStatus() {
                return {
                    initialized: this.initialized,
                    totalScreens: this.screens.size,
                    currentScreen: this.currentScreen,
                    screenList: Array.from(this.screens.keys())
                };
            }
        }
        
        // Components class (simplified)
        class Components {
            constructor(eventBus, logger) {
                this.eventBus = eventBus;
                this.logger = logger;
                this.initialized = false;
                this.renderCount = 0;
                
                this.initialized = true;
                this.logger.info('Components initialized');
                this.eventBus.emit('components.initialized', { timestamp: Date.now() });
            }
            
            renderPilotCards(container, pilots) {
                const containerElement = document.getElementById(container);
                if (!containerElement) return false;
                
                const html = pilots.map(pilot => `
                    <div class="pilot-card" onclick="selectPilot(${pilot.id})">
                        <div class="pilot-header">
                            <h4>${pilot.name}</h4>
                            <span class="experience ${pilot.experience}">${pilot.experience}</span>
                        </div>
                        <div class="pilot-stats">
                            <div class="stat-line">
                                <span>Gunnery:</span>
                                <span class="stat-value">${pilot.gunnery}</span>
                            </div>
                            <div class="stat-line">
                                <span>Piloting:</span>
                                <span class="stat-value">${pilot.piloting}</span>
                            </div>
                            <div class="stat-line">
                                <span>Salary:</span>
                                <span class="salary">${pilot.salary.toLocaleString()} C-Bills</span>
                            </div>
                        </div>
                        <div class="pilot-status">
                            Status: <span class="status ${pilot.status}">${pilot.status}</span>
                        </div>
                    </div>
                `).join('');
                
                containerElement.innerHTML = html;
                this.renderCount++;
                this.logger.info(`Rendered ${pilots.length} pilot cards`);
                return true;
            }
            
            renderMechCards(container, mechs, pilots) {
                const containerElement = document.getElementById(container);
                if (!containerElement) return false;
                
                const html = mechs.map(mech => {
                    const pilot = pilots.find(p => p.id === mech.pilot);
                    const pilotName = pilot ? pilot.name : 'Unassigned';
                    
                    return `
                        <div class="mech-card" onclick="selectMech(${mech.id})">
                            <div class="mech-header">
                                <h4>${mech.name}</h4>
                                <span class="mech-type ${mech.type}">${mech.type} (${mech.weight}t)</span>
                            </div>
                            <div class="mech-stats">
                                <div class="stat-line">
                                    <span>Condition:</span>
                                    <span class="condition ${mech.condition}">${mech.condition}</span>
                                </div>
                                <div class="stat-line">
                                    <span>Pilot:</span>
                                    <span class="pilot-name">${pilotName}</span>
                                </div>
                                <div class="stat-line">
                                    <span>Armor:</span>
                                    <span class="armor">${mech.armor}%</span>
                                </div>
                            </div>
                            <div class="mech-weapons">
                                <strong>Weapons:</strong> ${mech.weapons.join(', ')}
                            </div>
                        </div>
                    `;
                }).join('');
                
                containerElement.innerHTML = html;
                this.renderCount++;
                this.logger.info(`Rendered ${mechs.length} mech cards`);
                return true;
            }
            
            getStatus() {
                return {
                    initialized: this.initialized,
                    totalRenders: this.renderCount
                };
            }
        }
        
        // Test variables
        let game = null;
        let gameState = null;
        let screenManager = null;
        let components = null;
        let testResults = [];
        
        // Console capture
        const logMessages = [];
        const originalLog = console.log;
        
        console.log = function(...args) {
            const message = args.join(' ');
            logMessages.push(`${new Date().toISOString()}: ${message}`);
            updateLogDisplay();
            originalLog.apply(console, args);
        };
        
        function updateLogDisplay() {
            const logContent = document.getElementById('log-content');
            if (logContent) {
                logContent.textContent = logMessages.slice(-50).join('\\n');
                const logOutput = document.getElementById('log-output');
                logOutput.scrollTop = logOutput.scrollHeight;
            }
        }
        
        function addTestResult(phase, testName, passed, details = '') {
            testResults.push({ phase, testName, passed, details, timestamp: Date.now() });
            updateTestDisplay();
        }
        
        function updateTestDisplay() {
            const phase1Div = document.getElementById('phase1-results');
            const phase2Div = document.getElementById('phase2-results');
            const phase3Div = document.getElementById('phase3-results');
            const integrationDiv = document.getElementById('integration-results');
            
            phase1Div.innerHTML = '';
            phase2Div.innerHTML = '';
            phase3Div.innerHTML = '';
            integrationDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'success' : 'error'}`;
                div.innerHTML = `
                    <strong>${result.passed ? '‚úÖ' : '‚ùå'} ${result.testName}</strong>
                    ${result.details ? `<br><small>${result.details}</small>` : ''}
                `;
                
                if (result.phase === 1) phase1Div.appendChild(div);
                else if (result.phase === 2) phase2Div.appendChild(div);
                else if (result.phase === 3) phase3Div.appendChild(div);
                else if (result.phase === 'integration') integrationDiv.appendChild(div);
            });
            
            // Check completion
            const phase1Complete = testResults.filter(r => r.phase === 1 && r.passed).length >= 3;
            const phase2Complete = testResults.filter(r => r.phase === 2 && r.passed).length >= 2;
            const phase3Complete = testResults.filter(r => r.phase === 3 && r.passed).length >= 2;
            const integrationComplete = testResults.filter(r => r.phase === 'integration' && r.passed).length >= 3;
            
            if (phase1Complete && !document.getElementById('phase1-complete')) {
                const completeDiv = document.createElement('div');
                completeDiv.id = 'phase1-complete';
                completeDiv.className = 'phase-complete';
                completeDiv.innerHTML = 'üéØ PHASE 1 COMPLETE - CORE BULLETPROOF!';
                phase1Div.appendChild(completeDiv);
            }
            
            if (phase2Complete && !document.getElementById('phase2-complete')) {
                const completeDiv = document.createElement('div');
                completeDiv.id = 'phase2-complete';
                completeDiv.className = 'phase-complete';
                completeDiv.innerHTML = 'üéØ PHASE 2 COMPLETE - STATE BULLETPROOF!';
                phase2Div.appendChild(completeDiv);
            }
            
            if (phase3Complete && !document.getElementById('phase3-complete')) {
                const completeDiv = document.createElement('div');
                completeDiv.id = 'phase3-complete';
                completeDiv.className = 'phase-complete';
                completeDiv.innerHTML = 'üéØ PHASE 3 COMPLETE - UI BULLETPROOF!';
                phase3Div.appendChild(completeDiv);
            }
            
            if (integrationComplete && !document.getElementById('integration-complete')) {
                const completeDiv = document.createElement('div');
                completeDiv.id = 'integration-complete';
                completeDiv.className = 'phase-complete';
                completeDiv.innerHTML = 'üöÄ COMPLETE BULLETPROOF ARCHITECTURE VALIDATED!';
                integrationDiv.appendChild(completeDiv);
            }
        }
        
        // Global functions
        window.runCompleteTest = async function() {
            console.log('üöÄ Starting Complete Bulletproof Architecture Test...');
            testResults = [];
            
            try {
                // Phase 1: Core Systems
                console.log('üîß Testing Phase 1: Core Systems...');
                game = new Game();
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (game.initialized) {
                    addTestResult(1, 'Game System Initialization', true, 'Core systems bulletproof');
                } else {
                    addTestResult(1, 'Game System Initialization', false);
                    return;
                }
                
                // Test EventBus
                let eventReceived = false;
                game.eventBus.on('test.event', () => { eventReceived = true; });
                game.eventBus.emit('test.event', {});
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (eventReceived) {
                    addTestResult(1, 'EventBus Communication', true, 'Cross-module communication working');
                } else {
                    addTestResult(1, 'EventBus Communication', false);
                    return;
                }
                
                // Test Logger
                const loggerStatus = game.logger.getStatus();
                if (loggerStatus.context === 'Game') {
                    addTestResult(1, 'Logger System', true, `${loggerStatus.totalLogs} log entries recorded`);
                } else {
                    addTestResult(1, 'Logger System', false);
                    return;
                }
                
                // Phase 2: State Management
                console.log('üóÑÔ∏è Testing Phase 2: State Management...');
                gameState = new GameState(game.eventBus, game.logger);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (gameState.initialized) {
                    addTestResult(2, 'GameState System', true, 'State management initialized');
                } else {
                    addTestResult(2, 'GameState System', false);
                    return;
                }
                
                const pilots = gameState.getPilots();
                const mechs = gameState.getMechs();
                
                if (pilots.length >= 3 && mechs.length >= 3) {
                    addTestResult(2, 'Game Data Integrity', true, `${pilots.length} pilots, ${mechs.length} mechs loaded`);
                } else {
                    addTestResult(2, 'Game Data Integrity', false);
                    return;
                }
                
                // Phase 3: UI Foundation
                console.log('üé® Testing Phase 3: UI Foundation...');
                screenManager = new ScreenManager(game.eventBus, game.logger);
                components = new Components(game.eventBus, game.logger);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (screenManager.initialized && components.initialized) {
                    addTestResult(3, 'UI Systems Initialization', true, `${screenManager.getStatus().totalScreens} screens discovered`);
                } else {
                    addTestResult(3, 'UI Systems Initialization', false);
                    return;
                }
                
                // Test screen transitions
                const screenSuccess = screenManager.showScreen('demo-screen-2');
                if (screenSuccess) {
                    addTestResult(3, 'Screen Management', true, 'Screen transitions working');
                } else {
                    addTestResult(3, 'Screen Management', false);
                    return;
                }
                
                // Integration Tests
                console.log('üöÄ Testing Complete Integration...');
                
                // Test state-to-UI integration
                const renderSuccess = components.renderPilotCards('pilot-cards', pilots);
                if (renderSuccess) {
                    addTestResult('integration', 'State-to-UI Integration', true, 'Game data rendered to UI components');
                } else {
                    addTestResult('integration', 'State-to-UI Integration', false);
                    return;
                }
                
                // Test event propagation
                let uiEventReceived = false;
                game.eventBus.on('ui.test.event', () => { uiEventReceived = true; });
                game.eventBus.emit('ui.test.event', {});
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (uiEventReceived) {
                    addTestResult('integration', 'Full Event Pipeline', true, 'Events flow through all system layers');
                } else {
                    addTestResult('integration', 'Full Event Pipeline', false);
                    return;
                }
                
                // Test system status reporting
                const gameStatus = game.getStatus();
                const screenStatus = screenManager.getStatus();
                const componentStatus = components.getStatus();
                
                if (gameStatus.initialized && screenStatus.initialized && componentStatus.initialized) {
                    addTestResult('integration', 'System Status Reporting', true, 'All systems reporting healthy status');
                } else {
                    addTestResult('integration', 'System Status Reporting', false);
                    return;
                }
                
                console.log('üéâ COMPLETE BULLETPROOF ARCHITECTURE VALIDATED!');
                console.log('‚úÖ Phase 1: Core Systems - BULLETPROOF');
                console.log('‚úÖ Phase 2: State Management - BULLETPROOF');
                console.log('‚úÖ Phase 3: UI Foundation - BULLETPROOF');
                console.log('‚úÖ Full Integration - BULLETPROOF');
                
            } catch (error) {
                console.error('‚ùå Architecture test failed:', error);
                addTestResult('integration', 'Critical Architecture Error', false, `Error: ${error.message}`);
            }
        };
        
        window.runUIDemo = function() {
            if (!gameState || !screenManager || !components) {
                alert('Run complete test first!');
                return;
            }
            
            const demoDiv = document.getElementById('ui-demo');
            demoDiv.innerHTML = '<h3>üéÆ Live UI System Working!</h3>';
            
            // Render pilot cards
            const pilots = gameState.getPilots();
            components.renderPilotCards('pilot-cards', pilots);
            
            // Render mech cards  
            const mechs = gameState.getMechs();
            components.renderMechCards('mech-cards', mechs, pilots);
            
            demoDiv.innerHTML += '<p>‚úÖ Pilot and mech cards rendered successfully</p>';
            demoDiv.innerHTML += '<p>‚úÖ Screen navigation working</p>';
            demoDiv.innerHTML += '<p>‚úÖ Click the cards and navigation buttons to see the UI in action!</p>';
        };
        
        window.showScreen = function(screenId) {
            if (screenManager) {
                screenManager.showScreen(screenId);
            }
        };
        
        window.selectPilot = function(pilotId) {
            console.log(`Pilot ${pilotId} selected via UI component`);
            if (game) {
                game.eventBus.emit('pilot.selected', { pilotId, timestamp: Date.now() });
            }
        };
        
        window.selectMech = function(mechId) {
            console.log(`Mech ${mechId} selected via UI component`);
            if (game) {
                game.eventBus.emit('mech.selected', { mechId, timestamp: Date.now() });
            }
        };
        
        window.clearResults = function() {
            testResults = [];
            updateTestDisplay();
        };
        
        window.clearLog = function() {
            logMessages.length = 0;
            updateLogDisplay();
        };
        
        // Initialize
        console.log('üåü Complete Bulletproof Architecture Test Environment Ready');
        console.log('Click "Run Complete Architecture Test" to validate all three phases');
        updateLogDisplay();
    </script>
</body>
</html>